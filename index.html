<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Prompt Manager - Mobile Optimized</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Base Theme Variables - Applied to body for best compatibility */
        body {
            --sat: env(safe-area-inset-top);
            --sar: env(safe-area-inset-right);
            --sab: env(safe-area-inset-bottom);
            --sal: env(safe-area-inset-left);
            
            --bg-main: #0f172a;
            --bg-gradient: radial-gradient(circle at top left, #1e293b, #0f172a);
            --text-main: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(0, 0, 0, 0.3);
            --card-text: #94a3b8;
            --icon-color: #f8fafc;
            --toast-bg: #1e293b;
            --toast-text: #ffffff;
            
            background: var(--bg-main);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding-top: calc(1rem + var(--sat));
            padding-bottom: calc(2rem + var(--sab));
            padding-left: calc(1rem + var(--sal));
            padding-right: calc(1rem + var(--sar));
            transition: background 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
        }

        /* Light Theme Variable Overrides */
        body.light-theme {
            --bg-main: #f1f5f9;
            --bg-gradient: radial-gradient(circle at top left, #ffffff, #e2e8f0);
            --text-main: #0f172a;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(0, 0, 0, 0.1);
            --input-bg: rgba(255, 255, 255, 0.95);
            --card-text: #475569;
            --icon-color: #0f172a;
            --toast-bg: #ffffff;
            --toast-text: #0f172a;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            transition: background 0.4s ease, border 0.4s ease;
        }

        .glass-input {
            background: var(--input-bg);
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            font-size: 16px !important; /* Prevents auto-zoom on mobile */
            color: var(--text-main);
        }

        .glass-input:focus {
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1);
            outline: none;
        }

        .mono {
            font-family: 'Fira Code', monospace;
        }

        .accent-blue { background: linear-gradient(135deg, #38bdf8, #2563eb); }
        .accent-purple { background: linear-gradient(135deg, #a855f7, #7c3aed); }
        .accent-pink { background: linear-gradient(135deg, #f472b6, #db2777); }
        .accent-emerald { background: linear-gradient(135deg, #34d399, #059669); }

        .item-card {
            transition: transform 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .touch-target {
            min-width: 44px;
            min-height: 44px;
        }

        /* Assistive Touch Ball */
        #assistive-touch {
            position: fixed;
            width: 58px;
            height: 58px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1.5px solid var(--glass-border);
            border-radius: 50%;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            touch-action: none;
            user-select: none;
            right: 20px;
            bottom: 40px;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.4s ease;
        }

        #assistive-touch:active {
            transform: scale(0.85);
        }

        .icon-container {
            width: 28px;
            height: 28px;
            color: var(--icon-color);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s ease;
            pointer-events: none; /* Prevents icon from blocking events */
        }

        #toast {
            background-color: var(--toast-bg);
            color: var(--toast-text);
            border: 1px solid var(--glass-border);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(128, 128, 128, 0.4); border-radius: 10px; }
    </style>
</head>
<body>
    <!-- Assistive Touch Ball -->
    <div id="assistive-touch">
        <div id="icon-box" class="icon-container">
            <!-- Default Moon Icon (Dark Mode) -->
            <svg id="theme-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </div>
    </div>

    <div class="w-full max-w-2xl px-2">
        <!-- Form Input -->
        <div class="glass p-5 md:p-6 rounded-[2.5rem] mb-8 shadow-2xl mt-4">
            <div class="flex flex-col gap-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="inputTitle" placeholder="Judul (Wajib)" 
                        class="glass-input w-full px-5 py-4 rounded-3xl outline-none">
                    
                    <input type="url" id="inputLink" placeholder="Tautan (Opsional)" 
                        class="glass-input w-full px-5 py-4 rounded-3xl outline-none">
                </div>
                
                <textarea id="inputPrompt" rows="3" placeholder="Masukkan detail prompt di sini... (Opsional)" 
                    class="glass-input w-full px-5 py-4 rounded-3xl outline-none resize-none"></textarea>
                
                <div class="flex gap-2">
                    <button id="saveBtn" onclick="saveItem()" 
                        class="flex-1 touch-target accent-blue text-white text-sm font-bold uppercase tracking-widest rounded-[1.5rem] transition-all active:scale-95 shadow-lg shadow-blue-500/20">
                        Simpan
                    </button>
                    <button id="cancelBtn" onclick="clearForm()" 
                        class="hidden px-6 touch-target bg-slate-500/20 text-current text-sm font-bold uppercase tracking-widest rounded-[1.5rem] active:scale-95 transition-all">
                        Batal
                    </button>
                </div>
            </div>
        </div>

        <!-- List Container -->
        <div id="itemList" class="space-y-4 pb-20">
            <!-- Data akan dimunculkan di sini -->
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 text-xs font-bold px-6 py-4 rounded-full shadow-2xl transform translate-y-32 opacity-0 transition-all duration-500 z-[100] whitespace-nowrap flex items-center gap-3">
            <div id="toastIcon" class="w-2 h-2 rounded-full bg-blue-500"></div>
            <span id="toastMsg">Sistem Siap</span>
        </div>

        <!-- Delete Modal -->
        <div id="deleteModal" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden items-center justify-center z-[110] p-6">
            <div class="glass p-8 max-w-xs w-full rounded-[3rem] text-center border border-white/10 shadow-3xl">
                <div class="w-16 h-16 bg-red-500/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2m-6 9v4m4-4v4"/></svg>
                </div>
                <h3 class="text-xl font-bold mb-2">Hapus?</h3>
                <p class="opacity-60 text-sm mb-8 leading-relaxed">Data akan dihapus permanen dari memori HP Anda.</p>
                <div class="flex flex-col gap-2">
                    <button id="confirmDeleteBtn" class="w-full py-4 bg-red-600 text-white text-sm font-bold uppercase tracking-widest rounded-2xl shadow-lg shadow-red-500/20">Hapus Sekarang</button>
                    <button onclick="closeModal()" class="w-full py-4 opacity-50 text-sm font-bold uppercase tracking-widest rounded-2xl">Kembali</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let promptItems = JSON.parse(localStorage.getItem('glass_prompt_data')) || [];
        let itemToDeleteId = null;
        let editingId = null;

        const accents = ['accent-blue', 'accent-purple', 'accent-pink', 'accent-emerald'];

        // Assistive Touch Logic
        const ball = document.getElementById('assistive-touch');
        const iconBox = document.getElementById('icon-box');
        let isDragging = false;
        let startX, startY, initialLeft, initialTop;
        let startTime;

        const onStart = (e) => {
            isDragging = true;
            startTime = Date.now();
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            startX = clientX;
            startY = clientY;
            initialLeft = ball.offsetLeft;
            initialTop = ball.offsetTop;
            ball.style.transition = 'none';
        };

        const onMove = (e) => {
            if (!isDragging) return;
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const dx = clientX - startX;
            const dy = clientY - startY;

            let newLeft = initialLeft + dx;
            let newTop = initialTop + dy;

            const padding = 10;
            newLeft = Math.max(padding, Math.min(newLeft, window.innerWidth - ball.offsetWidth - padding));
            newTop = Math.max(padding, Math.min(newTop, window.innerHeight - ball.offsetHeight - padding));

            ball.style.left = `${newLeft}px`;
            ball.style.top = `${newTop}px`;
            ball.style.right = 'auto';
            ball.style.bottom = 'auto';
        };

        const onEnd = (e) => {
            if (!isDragging) return;
            isDragging = false;
            ball.style.transition = 'transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            const clientX = e.type.includes('touch') ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.changedTouches[0].clientY : e.clientY;
            
            const distance = Math.sqrt(Math.pow(clientX - startX, 2) + Math.pow(clientY - startY, 2));
            const duration = Date.now() - startTime;

            // Tolerance for click: moved less than 20px and happened within 300ms
            if (distance < 20 && duration < 300) {
                toggleTheme();
            }
        };

        // Desktop Events
        ball.addEventListener('mousedown', onStart);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onEnd);

        // Mobile Events
        ball.addEventListener('touchstart', onStart, { passive: false });
        window.addEventListener('touchmove', onMove, { passive: false });
        window.addEventListener('touchend', onEnd);

        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-theme');
            
            // Icon Animation
            iconBox.style.transform = 'scale(0) rotate(180deg)';
            
            setTimeout(() => {
                if (isLight) {
                    iconBox.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>`;
                } else {
                    iconBox.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>`;
                }
                iconBox.style.transform = 'scale(1) rotate(0deg)';
            }, 200);

            showToast(isLight ? "Mode Terang" : "Mode Gelap", isLight ? "bg-orange-400" : "bg-blue-500");
        }

        // CRUD Logic
        function saveItem() {
            const title = document.getElementById('inputTitle').value.trim();
            const link = document.getElementById('inputLink').value.trim();
            const prompt = document.getElementById('inputPrompt').value.trim();

            if (!title) {
                showToast("Judul wajib diisi!", "bg-red-500");
                return;
            }

            if (editingId) {
                const index = promptItems.findIndex(i => i.id === editingId);
                if (index !== -1) {
                    promptItems[index] = { ...promptItems[index], title, link, prompt };
                    showToast("Data Diperbarui", "bg-emerald-500");
                }
            } else {
                promptItems.push({
                    id: Date.now(),
                    title: title,
                    link: link,
                    prompt: prompt,
                    colorClass: accents[Math.floor(Math.random() * accents.length)]
                });
                showToast("Data Berhasil Disimpan", "bg-blue-500");
            }

            sortAndSave();
            renderItems();
            clearForm();
        }

        function sortAndSave() {
            promptItems.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));
            localStorage.setItem('glass_prompt_data', JSON.stringify(promptItems));
        }

        function clearForm() {
            document.getElementById('inputTitle').value = '';
            document.getElementById('inputLink').value = '';
            document.getElementById('inputPrompt').value = '';
            editingId = null;
            document.getElementById('saveBtn').innerText = 'Simpan';
            document.getElementById('saveBtn').className = 'flex-1 touch-target accent-blue text-white text-sm font-bold uppercase tracking-widest rounded-[1.5rem] transition-all active:scale-95 shadow-lg shadow-blue-500/20';
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        function editItem(id) {
            const item = promptItems.find(i => i.id === id);
            if (item) {
                document.getElementById('inputTitle').value = item.title;
                document.getElementById('inputLink').value = item.link;
                document.getElementById('inputPrompt').value = item.prompt;
                editingId = id;
                document.getElementById('saveBtn').innerText = 'Perbarui';
                document.getElementById('saveBtn').className = 'flex-1 touch-target accent-emerald text-white text-sm font-bold uppercase tracking-widest rounded-[1.5rem] transition-all active:scale-95 shadow-lg shadow-emerald-500/20';
                document.getElementById('cancelBtn').classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function copyToClipboard(id) {
            const item = promptItems.find(i => i.id === id);
            if (item) {
                const text = item.prompt || "";
                if (!text) {
                    showToast("Prompt Kosong!", "bg-yellow-500");
                    return;
                }
                const el = document.createElement('textarea');
                el.value = text;
                document.body.appendChild(el);
                el.select();
                try {
                    document.execCommand('copy');
                    showToast("Prompt Disalin!", "bg-emerald-500");
                } catch (e) {
                    showToast("Gagal menyalin", "bg-red-500");
                }
                document.body.removeChild(el);
            }
        }

        function openDeleteModal(id) {
            itemToDeleteId = id;
            const modal = document.getElementById('deleteModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('confirmDeleteBtn').onclick = () => {
                promptItems = promptItems.filter(i => i.id !== itemToDeleteId);
                if (editingId === itemToDeleteId) clearForm();
                sortAndSave();
                renderItems();
                closeModal();
                showToast("Data Dihapus", "bg-red-500");
            };
        }

        function closeModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('flex');
            itemToDeleteId = null;
        }

        function showToast(msg, colorClass) {
            const t = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const label = document.getElementById('toastMsg');
            label.innerText = msg;
            icon.className = `w-2 h-2 rounded-full ${colorClass}`;
            t.classList.remove('opacity-0', 'translate-y-32');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-32'), 2500);
        }

        function renderItems() {
            const container = document.getElementById('itemList');
            container.innerHTML = '';

            if (promptItems.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20 opacity-30">
                        <p class="text-xs uppercase tracking-[0.3em]">Workspace Kosong</p>
                    </div>`;
                return;
            }

            promptItems.forEach(item => {
                const div = document.createElement('div');
                div.className = `item-card glass p-5 rounded-[2.5rem] flex flex-col gap-4 ${editingId === item.id ? 'ring-2 ring-emerald-500' : ''}`;
                const colorClass = item.colorClass || 'accent-blue';

                div.innerHTML = `
                    <div class="flex justify-between items-start gap-3">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <div class="w-2 h-2 rounded-full ${colorClass}"></div>
                                <h3 class="text-[15px] font-bold truncate uppercase tracking-tight">${item.title}</h3>
                            </div>
                            ${item.link ? `<a href="${item.link}" target="_blank" class="text-[11px] text-blue-500 truncate block underline opacity-60">${item.link}</a>` : ''}
                        </div>
                        <div class="flex gap-2 shrink-0">
                            <button onclick="copyToClipboard(${item.id})" class="touch-target p-3 bg-slate-500/10 rounded-2xl active:bg-slate-500/30 transition-all">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                            <button onclick="editItem(${item.id})" class="touch-target p-3 bg-slate-500/10 rounded-2xl active:bg-slate-500/30 transition-all">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.1 2.1 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            </button>
                            <button onclick="openDeleteModal(${item.id})" class="touch-target p-3 bg-red-500/10 rounded-2xl text-red-500 active:bg-red-500/30 transition-all">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            </button>
                        </div>
                    </div>
                    ${item.prompt ? `
                    <div class="bg-black/10 p-5 rounded-3xl text-[13px] mono whitespace-pre-wrap max-h-56 overflow-y-auto border border-white/5 leading-relaxed opacity-70">
                        ${item.prompt}
                    </div>` : ''}
                `;
                container.appendChild(div);
            });
        }

        // Initialize
        window.onload = renderItems;
    </script>
</body>
</html>
